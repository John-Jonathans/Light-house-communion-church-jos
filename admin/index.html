<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel</title>
    <style>
      body { background-color: #f3f4f6; font-family: sans-serif; margin: 0; padding: 20px; }
      #status { background: white; padding: 30px; border-radius: 15px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-top: 50px; }
      h1 { color: #1f2937; margin-bottom: 10px; }
      p { color: #6b7280; }
      .success { color: #166534; font-weight: bold; background: #dcfce7; padding: 10px; border-radius: 5px; display: inline-block; margin-top: 10px;}
    </style>
  </head>
  <body>
    <div id="status">
        <h1>⚙️ Admin Panel</h1>
        <p>Waiting for login...</p>
        <div id="msg"></div>
    </div>

    <script>
      // Function to shout the password
      function broadcastToken() {
        const tokenMsg = localStorage.getItem("cms_auth_token");
        
        if (tokenMsg) {
          // Update the screen
          const msgDiv = document.getElementById('msg');
          msgDiv.innerHTML = "<div class='success'>✅ Key Found! Retrying connection...</div>";
          
          // Send the signal repeatedly (every 2 seconds)
          // We DO NOT delete the key immediately anymore.
          console.log("Sending token to CMS...");
          window.postMessage(tokenMsg, "*");
        }
      }

      // Check and Broadcast every 1 second
      setInterval(broadcastToken, 1000);
    </script>

    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  </body>
</html>

