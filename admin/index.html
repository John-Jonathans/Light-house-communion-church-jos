<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel</title>
    <style>
      /* A loading overlay that covers the login button if we have a key */
      #auto-login-msg {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(255,255,255,0.95); z-index: 9999;
        display: none; /* Hidden by default */
        flex-direction: column; justify-content: center; align-items: center;
        font-family: sans-serif; text-align: center;
      }
      h2 { color: #166534; }
    </style>
  </head>
  <body>
    <script>
      // Check if we have a key from the Green Screen
      const tokenMsg = localStorage.getItem("cms_auth_token");

      if (tokenMsg) {
        // A. Show the "Logging in" overlay immediately
        document.write('<div id="auto-login-msg" style="display:flex;"><h2>üîê Key Found!</h2><p>Hammering the dashboard to open...</p></div>');

        // B. Spam the signal every 0.5 seconds for 15 seconds
        let attempts = 0;
        const interval = setInterval(() => {
          window.postMessage(tokenMsg, "*");
          console.log("Sent Login Signal: " + attempts);
          attempts++;
          
          // Stop after 30 attempts (15 seconds) to save battery
          if (attempts > 30) clearInterval(interval);
        }, 500);
      }
    </script>

    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  </body>
</html>
